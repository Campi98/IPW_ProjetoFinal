<!DOCTYPE html>
<!--LADRILHO - Aplicação gráfica interativa de manipulação simples de um ladrilho, destinado à avaliação de competências, no ano letivo de 2022-2023, do aluno n.º 25269, João Campos.-->
<html lang="pt">
    <head>
        <meta charset="utf-8" />
        <title>LADRILHO - 25269</title>
        <style>
            body {
                background-color:#c0c0c0;}
                
			#bigDiv{                
				width: 1000px;
                border: 6px inset; 
                margin: 0px auto;
                overflow: auto;
                background-color:#c0c0c0;
			}
			#blockPanel{
				display: block; 
				margin: 10px; 
				float: left;
                /*border: 5px solid yellow; /*comentar/tirar border toda*/
			}
			#blockPreview{
				width: 156px;
				height: 156px;
                border: 2px /*solid black*/; 

			}
			#previewAndMenu{
				width: 334px; 
				margin: 20px 20px 0px 0px; 
				float: left;
                /*border: 5px solid pink; /*comentar/tirar border toda*/
			}
			#labels{
				font: bold 19px arial; 
				color: #802000;
			}
			#modValue{
				width: 40px;
				font: bold 22px arial;
				background-color: #ffffff;
				display: inline-block;
				text-align: center;
			}
            button{
                font: 19px arial; 
                padding: 1px 8px;
            }

            


		</style>
        <script>
            var refTela1, graf1, corDab, colorsApplied = false, blockPanel;
            var coresAtuais = ["#ff4000", "#ff8000", "#ffbf00", "#ffff00"]; // cores padrão
            //inicialização
            function inic() {
                
                blockPanel = document.getElementById("blockPanel");
                newGrid(); // cria a grid grande
                

                //coisas para os triangulos do preview
				refTela1 = document.getElementById("blockPreview");
				graf1 = refTela1.getContext("2d");
                
                mostraCores(); // mostra as 4 cores
                //updateModularidade();
                
            }

            //******** input/output ********

            //output de um conteúdo num contentor HTML, dados o ID do contentor e o conteúdo (boleano, número ou string)
            function out(idCont, conteudo) {
                document.getElementById(idCont).innerHTML = conteudo;
            }

            //********* processos **********

            //referência a um objeto HTML, dado o seu ID
            function refID(idObj) {
                return document.getElementById(idObj);
            }

            //lista das componentes RGB decimais de uma cor representada em código hexadecimal
            function rgbHex(ch) {
                var i, cd = [];
                for (i = 0; i < 3; i++)
                    cd.push(parseInt(ch[2 * i + 1] + ch[2 * i + 2], 16));
                return cd;
            }

            //representação em código hexadecimal de uma cor representada segundo uma lista das componentes RGB decimais
            function hexRGB(cd) {
                var i, comp, ch = "#";
                for (i = 0; i < 3; i++) {
                    comp = Math.round(cd[i]).toString(16);
                    if (cd[i] > 15) ch += comp;
                    else ch += "0" + comp;
                }
                return ch;
            }

            //lista das componentes HSL de uma cor representada em lista de componentes RGB decimais
            function hslRGB(cd) {
                var R, G, B, H, S, L, min, max;
                //converte os valores RGB para o intervalo 0-1 e determina o mínimo e o máximo
                R = cd[0] / 255;
                G = cd[1] / 255;
                B = cd[2] / 255;
                min = Math.min(R, G, B);
                max = Math.max(R, G, B);
                //Luminosidade
                L = (min + max) / 2;
                //se for um cinza, a saturação e a matiz são zero
                if (max == min) return [0, 0, L];
                //SATURAÇÃO
                if (L <= 0.5) S = (max - min) / (max + min);
                else S = (max - min) / (2 - max - min);
                //MATIZ (HUE) (escala 0-6)
                if (max == R) H = (G - B) / (max - min);
                if (max == G) H = 2 + (B - R) / (max - min);
                if (max == B) H = 4 + (R - G) / (max - min);
                //Resultado
                return [60 * H, S, L];
            }

            //lista das componentes RGB decimais de uma cor representada em lista de componentes HSL
            function rgbHSL(cHSL) {
                //extrai as componentes
                var h = cHSL[0],
                    s = cHSL[1],
                    l = cHSL[2];
                //estabelece os parâmetros da fórmula
                const k = (n) => (n + h / 30) % 12;
                const a = s * Math.min(l, 1 - l);
                //estabelece a fórmula
                const f = (n) =>
                    l -
                    a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));
                //resultado
                return [
                    Math.round(255 * f(0)),
                    Math.round(255 * f(8)),
                    Math.round(255 * f(4)),
                ];
            }

            //gera uma lista de tons cromáticos, em código hexadecimal, por ordem crescente de luminosidade, dados o número de tons e a cor base, em código hexadecimal
            function listaTons(nTons, corBase) {
                var corHSL = hslRGB(rgbHex(corBase));
                var h = corHSL[0], s = corHSL[1], l = corHSL[2];
                var i, dl = 1 / (nTons + 2), lista = [];
                for (i = 1; i < nTons + 1; i++) {
                    lista.push(hexRGB(rgbHSL([h, s, i * dl])));
                }
                return lista;
            }


            function mainGrid(cGraf, x, y, dim, mod, withColors) {
                var a, b, c = dim / mod;
                cGraf.lineWidth = c / 200;

                for (a = 0; a < mod; a++) {
                    for (b = 0; b < mod; b++) {
                        if (withColors) {
                            // Desenha os triângulos coloridos em cada célula
                            drawTrianglesInCell(cGraf, x + b * c, y + a * c, c);
                        } else {
                            // Desenha apenas as linhas da grid
                            cGraf.beginPath();
                            cGraf.moveTo(x + b * c, y + a * c);
                            cGraf.lineTo(x + (b + 1) * c, y + (a + 1) * c);
                            cGraf.stroke();

                            cGraf.beginPath();
                            cGraf.moveTo(x + (b + 1) * c, y + a * c);
                            cGraf.lineTo(x + b * c, y + (a + 1) * c);
                            cGraf.stroke();

                            cGraf.beginPath();
                            cGraf.rect(x + b * c, y + a * c, c, c);
                            cGraf.stroke();
                        }
                    }
                }
		    }



            function newGrid() {
                var a = blockPanel.getContext("2d");
                a.clearRect(0, 0, blockPanel.width, blockPanel.height);
                mainGrid(a, 0, 0, blockPanel.width, refID("sliderMod").value, colorsApplied);
            }

            // Função para desenhar triângulos coloridos numa célula específica
            function drawTrianglesInCell(cGraf, x, y, lado) {
                cGraf.globalAlpha = 1;
                cGraf.strokeStyle = "black";
                cGraf.lineWidth = lado / 200;

                // Triangulo esquerdo
                cGraf.fillStyle = coresAtuais[2];
                cGraf.beginPath();
                cGraf.moveTo(x, y);
                cGraf.lineTo(x, y + lado);
                cGraf.lineTo(x + (lado / 2), y + (lado / 2));
                cGraf.closePath();
                cGraf.fill();
                cGraf.stroke();

                // Triangulo de baixo
                cGraf.fillStyle = coresAtuais[0];
                cGraf.beginPath();
                cGraf.moveTo(x, y + lado);
                cGraf.lineTo(x + lado, y + lado);
                cGraf.lineTo(x + (lado / 2), y + (lado / 2));
                cGraf.closePath();
                cGraf.fill();
                cGraf.stroke();

                // Triangulo da direita
                cGraf.fillStyle = coresAtuais[1];
                cGraf.beginPath();
                cGraf.moveTo(x + lado, y + lado);
                cGraf.lineTo(x + lado, y);
                cGraf.lineTo(x + (lado / 2), y + (lado / 2));
                cGraf.closePath();
                cGraf.fill();
                cGraf.stroke();

                // Triangulo de cima
                cGraf.fillStyle = coresAtuais[3];
                cGraf.beginPath();
                cGraf.moveTo(x + lado, y);
                cGraf.lineTo(x, y);
                cGraf.lineTo(x + (lado / 2), y + (lado / 2));
                cGraf.closePath();
                cGraf.fill();
                cGraf.stroke();
            }

            // Função para aplicar o padrão de cores a toda a grid
            function applyColor() {
                colorsApplied = true;
                var a = blockPanel.getContext("2d");
                a.clearRect(0, 0, blockPanel.width, blockPanel.height);
                mainGrid(a, 0, 0, blockPanel.width, refID("sliderMod").value, true);
            }

            // Função para limpar as cores e voltar apenas às linhas da grid
            function clearColors() {
                colorsApplied = false;
                newGrid();
            }

            // Função para atualizar o valor da modularidade e redesenhar os quadrados
            function updateModularidade() {
                var rangeModularidade = refID("sliderMod");
                var valorModularidade = rangeModularidade.value;
                var spanModularidade = refID("modValue");
                spanModularidade.textContent = valorModularidade;
            }

			//mostra as quatro cores em sequência de brilhos nos quatro DIVs da classe "cor"
			function mostraCores(){
				//lê a cor escolhida
				const cor = refID("cor").value;
				//gera as quatro cores
				coresAtuais = listaTons(4, cor);
                drawTriangles(1, 1, 154);
			}
            //

			function drawTriangles(x, y, lado){
                graf1.globalAlpha = 1;
                graf1.strokeStyle = "black";
                graf1.lineWidth = 2;
                
                var centerX = x + (lado / 2);
                var centerY = y + (lado / 2);
                
                // Array com as configurações de cada triângulo
                var triangles = [
                    // triangulo esquerdo
                    { color: coresAtuais[2], points: [[x, y], [x, y + lado], [centerX, centerY]] },
                    // triangulo de baixo
                    { color: coresAtuais[0], points: [[x, y + lado], [x + lado, y + lado], [centerX, centerY]] },
                    // triangulo da direita
                    { color: coresAtuais[1], points: [[x + lado, y + lado], [x + lado, y], [centerX, centerY]] },
                    // triangulo de cima
                    { color: coresAtuais[3], points: [[x + lado, y], [x, y], [centerX, centerY]] }
                ];
                
                triangles.forEach(function(triangle) {
                    graf1.fillStyle = triangle.color;
                    graf1.beginPath();
                    graf1.moveTo(triangle.points[0][0], triangle.points[0][1]);
                    graf1.lineTo(triangle.points[1][0], triangle.points[1][1]);
                    graf1.lineTo(triangle.points[2][0], triangle.points[2][1]);
                    graf1.closePath();
                    graf1.fill();
                    graf1.stroke();
                });
            }

        </script>
    </head>



    <body onload="inic()">


        <div id="bigDiv">
            <canvas id="blockPanel" width="606px" height="606px"></canvas>


            <div id="previewAndMenu">
                

                <canvas id="blockPreview" width="156" height="156"></canvas> <hr/>

                
                <span id="labels">Cor Base: </span>

                <!-- dois sliders das cores -->
                <input id="cor" type="color" value="#ff8000" oninput="mostraCores()" /> 

                
                <button onclick="applyColor()">aplicar ao padrão</button>
                <button onclick="clearColors()">limpar padrão</button> <hr/>
                
                <span id="labels">Modularidade: </span>
				<span id="modValue">12</span> <br/>

				<input id="sliderMod" style="width: 100%" type="range" min="1" max="40" value="12" step="1" oninput="updateModularidade(), newGrid()" />

                
            </div>
        </div>
    </body>
</html>



